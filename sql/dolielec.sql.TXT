-- Cache de costes por tercero/contexto
CREATE TABLE IF NOT EXISTS llx_dolielec_cost_cache (
  rowid integer AUTO_INCREMENT PRIMARY KEY,
  entity integer NOT NULL DEFAULT 1,
  fk_thirdparty integer NOT NULL,
  context_key varchar(64) NOT NULL,
  value decimal(24,8) NOT NULL,
  tms timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY uq_entity_third_ctx (entity, fk_thirdparty, context_key)
) ENGINE=innodb DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Entrenamiento de biel
CREATE TABLE IF NOT EXISTS llx_dolielec_biel_learn (
  rowid integer AUTO_INCREMENT PRIMARY KEY,
  entity integer NOT NULL DEFAULT 1,
  fk_blockid integer NOT NULL,
  fk_sublock integer,
  ctx MEDIUMTEXT NOT NULL,
  tms timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY BlockLearningID(fk_blockid, fk_sublock)
) ENGINE=innodb DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Frases para relación psicológica orientada
CREATE TABLE IF NOT EXISTS llx_dolielec_rpo (
  rowid integer AUTO_INCREMENT PRIMARY KEY,
  entity integer NOT NULL DEFAULT 1,
  rpoid varchar(10) NOT NULL,
  rpo_sentence varchar(255) NOT NULL,
  UNIQUE KEY RPO(rpoid)
) ENGINE=innodb DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Balance OpenAI
CREATE TABLE IF NOT EXISTS llx_dolielec_openai_balance (
  rowid integer AUTO_INCREMENT PRIMARY KEY,
entity integer NOT NULL DEFAULT 1,
  idmodel varchar(50) NOT NULL,
  total decimal(10,2) NOT NULL,
  tms timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY tokenid (idmodel)
) ENGINE=innodb DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Balance Anthropic
CREATE TABLE IF NOT EXISTS llx_dolielec_anthropic_balance (
  rowid integer AUTO_INCREMENT PRIMARY KEY,
entity integer NOT NULL DEFAULT 1,
  idmodel varchar(50) NOT NULL,
  total decimal(10,2) NOT NULL,
  tms timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY tokenid (idmodel)
) ENGINE=innodb DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Memorias del sistema
CREATE TABLE IF NOT EXISTS llx_dolielec_memories (
  rowid integer AUTO_INCREMENT PRIMARY KEY,
entity integer NOT NULL DEFAULT 1,
  msgid varchar(50) NOT NULL,
  message LONGTEXT NOT NULL,
  tms timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY id(msgid)
) ENGINE=innodb DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;